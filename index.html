<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>數位產品護照 | Digital Product Passport</title>
    
    <!-- 1. 載入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. 載入 React 和 Babel -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 自定義樣式 -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=JetBrains+Mono:wght@400&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        .animate-fadeIn { animation: fadeIn 0.5s ease-out forwards; }
        .animate-slideUp { animation: slideUp 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        /* 模擬程式碼區塊樣式 */
        .json-bg { background-color: #1e1e1e; color: #d4d4d4; }
        .json-key { color: #9cdcfe; }
        .json-string { color: #ce9178; }
        .json-number { color: #b5cea8; }
    </style>
</head>
<body class="bg-slate-50 text-gray-800">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Icon 組件 ---
        const IconBase = ({ children, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>
        );
        const QrCode = (p) => <IconBase {...p}><rect width="5" height="5" x="3" y="3" rx="1"/><rect width="5" height="5" x="16" y="3" rx="1"/><rect width="5" height="5" x="3" y="16" rx="1"/><path d="M21 16h-3a2 2 0 0 0-2 2v3"/><path d="M21 21v.01"/><path d="M12 7v3a2 2 0 0 1-2 2H7"/><path d="M3 12h.01"/><path d="M12 3h.01"/><path d="M12 16v.01"/><path d="M16 12h1"/><path d="M21 12v.01"/><path d="M12 21v-1"/></IconBase>;
        const Globe = (p) => <IconBase {...p}><circle cx="12" cy="12" r="10"/><line x1="2" x2="22" y1="12" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></IconBase>;
        const Recycle = (p) => <IconBase {...p}><path d="M7 19H4.815a1.83 1.83 0 0 1-1.57-.881 1.785 1.785 0 0 1-.004-1.784L7.196 9.5"/><path d="M11 19h8.203a1.83 1.83 0 0 0 1.556-.89 1.784 1.784 0 0 0 0-1.775l-1.226-2.12"/><path d="m14 16-3 3 3 3"/><path d="M8.293 13.596 7.196 9.5 3.1 7"/><path d="m4.8 19 3 3 3-3"/><path d="M8.5 7.5c.34-1.12.91-2.17 1.63-3.1.66-.85 1.54-1.4 2.51-1.4 2.2 0 4.18 1.48 4.97 3.5"/><path d="M15.5 4.5l3 3-3 3"/></IconBase>;
        const Info = (p) => <IconBase {...p}><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></IconBase>;
        const CheckCircle = (p) => <IconBase {...p}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></IconBase>;
        const MapPin = (p) => <IconBase {...p}><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></IconBase>;
        const Package = (p) => <IconBase {...p}><path d="m7.5 4.27 9 5.15"/><path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/><path d="m3.3 7 8.7 5 8.7-5"/><path d="M12 22v-9"/></IconBase>;
        const ArrowRight = (p) => <IconBase {...p}><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></IconBase>;
        const X = (p) => <IconBase {...p}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></IconBase>;
        const ShieldCheck = (p) => <IconBase {...p}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/><path d="m9 12 2 2 4-4"/></IconBase>;
        const FileJson = (p) => <IconBase {...p}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><path d="M10 13a2 2 0 0 0 2 2h4"/><path d="M12 15v3"/></IconBase>;
        const Lock = (p) => <IconBase {...p}><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></IconBase>;
        const Loader = (p) => <IconBase {...p} className={`${p.className} animate-spin`}><path d="M21 12a9 9 0 1 1-6.219-8.56"/></IconBase>;

        // --- 產品資料庫 (新增 verifiableCredential 欄位) ---
        const PRODUCT_DATABASE = {
            "09876543210123": {
                name: "EcoStep Pro 跑鞋",
                brand: "GreenWalk",
                image: "https://images.unsplash.com/photo-1542291026-7eec264c27ff?auto=format&fit=crop&w=600&q=80",
                description: "由 100% 海洋回收塑料製成的高性能跑鞋。",
                specs: { color: "海洋藍", size: "US 10", batch: "2024-Q1-TW" },
                traceability: [
                    { step: "原料採集", location: "台灣, 澎湖", date: "2023-10-01", icon: Recycle },
                    { step: "紡織加工", location: "台灣, 彰化", date: "2023-11-15", icon: Package },
                    { step: "最終組裝", location: "越南, 胡志明", date: "2024-01-20", icon: CheckCircle },
                ],
                materials: [{ name: "回收 PET", percentage: 80 }, { name: "天然橡膠", percentage: 20 }],
                disposal: "可透過品牌門市回收計畫進行回收。",
                verifiableCredential: {
                    "@context": ["https://www.w3.org/2018/credentials/v1"],
                    "type": ["VerifiableCredential", "SustainableProductClaim"],
                    "issuer": "did:web:issuer.greenwalk.com",
                    "issuanceDate": "2023-11-20T19:23:24Z",
                    "credentialSubject": {
                        "id": "did:web:dpp-demo.sdpp.tw:product:09876543210123",
                        "gtin": "09876543210123",
                        "claim": {
                            "recycledContent": "80%",
                            "carbonNeutral": true
                        }
                    },
                    "proof": {
                        "type": "JsonWebSignature2020",
                        "created": "2023-11-20T19:23:24Z",
                        "verificationMethod": "did:web:issuer.greenwalk.com#key-1",
                        "jws": "eyJhbGciOiJFZERTQSIsImI2NCI6ZmFsc2UsImNyaXQiOlsiYjY0Il19..."
                    }
                }
            },
            "09876543210456": {
                name: "PureCotton 經典 T-shirt",
                brand: "GreenWalk",
                image: "https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?auto=format&fit=crop&w=600&q=80",
                description: "無毒、無農藥的有機棉，對肌膚最溫柔的呵護。",
                specs: { color: "米白", size: "L", batch: "2024-JAN-Batch" },
                traceability: [
                    { step: "棉花種植", location: "土耳其, 伊茲密爾", date: "2023-08-01", icon: MapPin },
                    { step: "紡紗織布", location: "葡萄牙, 波爾圖", date: "2023-09-20", icon: Package },
                    { step: "品檢包裝", location: "德國, 漢堡", date: "2023-10-10", icon: CheckCircle },
                ],
                materials: [{ name: "有機棉", percentage: 100 }],
                disposal: "可自然生物降解，或投入衣物回收箱。",
                verifiableCredential: {
                    "@context": ["https://www.w3.org/2018/credentials/v1"],
                    "type": ["VerifiableCredential", "OrganicCottonCert"],
                    "issuer": "did:web:cert.global-organic.org",
                    "issuanceDate": "2023-09-15T10:00:00Z",
                    "credentialSubject": {
                        "id": "did:web:dpp-demo.sdpp.tw:product:09876543210456",
                        "gtin": "09876543210456",
                        "certificationLevel": "GOTS Certified"
                    }
                }
            },
            "09876543210789": {
                name: "EcoBottle 環保水壺",
                brand: "GreenWalk",
                image: "https://images.unsplash.com/photo-1602143407151-11115cd4e69b?auto=format&fit=crop&w=600&q=80",
                description: "不含 BPA，使用 100% 回收不鏽鋼製造。",
                specs: { color: "原色", size: "500ml", batch: "2024-S3" },
                traceability: [
                    { step: "鋼材回收", location: "高雄, 台灣", date: "2023-12-01", icon: Recycle },
                    { step: "成型加工", location: "台南, 台灣", date: "2024-01-15", icon: Package }
                ],
                materials: [{ name: "304 不鏽鋼", percentage: 95 }, { name: "矽膠", percentage: 5 }],
                disposal: "金屬部分可無限次回收。",
                verifiableCredential: {
                    "@context": ["https://www.w3.org/2018/credentials/v1"],
                    "type": ["VerifiableCredential", "MaterialSafetyCert"],
                    "issuer": "did:web:sgs-lab.com",
                    "issuanceDate": "2024-01-10T14:30:00Z",
                    "credentialSubject": {
                        "id": "did:web:dpp-demo.sdpp.tw:product:09876543210789",
                        "gtin": "09876543210789",
                        "bpaFree": true
                    }
                }
            }
        };

        // --- 組件: Verifiable Credential Modal (新增功能) ---
        const CredentialModal = ({ isOpen, onClose, data }) => {
            const [viewMode, setViewMode] = useState('visual'); // 'visual' or 'json'
            const [verificationState, setVerificationState] = useState('idle'); // idle, verifying, verified
            const [steps, setSteps] = useState([]);

            useEffect(() => {
                if (isOpen) {
                    setVerificationState('idle');
                    setSteps([]);
                }
            }, [isOpen]);

            const runVerification = () => {
                setVerificationState('verifying');
                setSteps([]);
                
                // 模擬驗證過程
                setTimeout(() => setSteps(s => [...s, { text: "解析發證者 DID (Decentralized Identifier)...", status: "done" }]), 500);
                setTimeout(() => setSteps(s => [...s, { text: "取得公開金鑰 (Public Key)...", status: "done" }]), 1500);
                setTimeout(() => setSteps(s => [...s, { text: "驗證數位簽章 (Cryptographic Proof)...", status: "done" }]), 2500);
                setTimeout(() => setSteps(s => [...s, { text: "檢查撤銷清單 (Revocation Registry)...", status: "done" }]), 3500);
                setTimeout(() => {
                    setVerificationState('verified');
                }, 4000);
            };

            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
                    <div className="absolute inset-0 bg-black/60 backdrop-blur-sm" onClick={onClose}></div>
                    <div className="bg-white rounded-2xl w-full max-w-lg shadow-2xl relative z-10 overflow-hidden flex flex-col max-h-[90vh] animate-slideUp">
                        {/* Header */}
                        <div className="bg-slate-900 text-white p-5 flex justify-between items-center">
                            <div className="flex items-center gap-2">
                                <ShieldCheck className="w-6 h-6 text-green-400" />
                                <div>
                                    <h3 className="font-bold text-lg">可驗證數位憑證</h3>
                                    <p className="text-xs text-slate-400">Verifiable Credential (W3C Standard)</p>
                                </div>
                            </div>
                            <button onClick={onClose} className="p-1 hover:bg-slate-800 rounded-full transition"><X className="w-6 h-6" /></button>
                        </div>

                        {/* Content */}
                        <div className="p-6 overflow-y-auto flex-1">
                            {/* Tabs */}
                            <div className="flex gap-2 mb-6 bg-slate-100 p-1 rounded-lg">
                                <button 
                                    onClick={() => setViewMode('visual')}
                                    className={`flex-1 py-2 text-sm font-medium rounded-md transition flex items-center justify-center gap-2 ${viewMode === 'visual' ? 'bg-white shadow text-slate-900' : 'text-slate-500 hover:text-slate-700'}`}
                                >
                                    <ShieldCheck className="w-4 h-4" /> 憑證檢視
                                </button>
                                <button 
                                    onClick={() => setViewMode('json')}
                                    className={`flex-1 py-2 text-sm font-medium rounded-md transition flex items-center justify-center gap-2 ${viewMode === 'json' ? 'bg-white shadow text-slate-900' : 'text-slate-500 hover:text-slate-700'}`}
                                >
                                    <FileJson className="w-4 h-4" /> 原始資料 (JSON-LD)
                                </button>
                            </div>

                            {viewMode === 'visual' ? (
                                <div className="space-y-6">
                                    {/* 憑證卡片 */}
                                    <div className="border border-slate-200 rounded-xl p-5 bg-slate-50 relative overflow-hidden">
                                        {verificationState === 'verified' && (
                                            <div className="absolute top-0 right-0 p-2">
                                                <div className="bg-green-100 text-green-700 text-xs font-bold px-3 py-1 rounded-full flex items-center gap-1 border border-green-200 shadow-sm">
                                                    <CheckCircle className="w-3 h-3" /> 已驗證 (Verified)
                                                </div>
                                            </div>
                                        )}
                                        
                                        <div className="space-y-4">
                                            <div>
                                                <p className="text-xs text-slate-500 uppercase font-bold tracking-wider mb-1">發證者 (Issuer)</p>
                                                <div className="flex items-center gap-2">
                                                    <div className="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 font-bold text-xs">DID</div>
                                                    <p className="text-sm font-mono text-slate-700 truncate">{data.issuer}</p>
                                                </div>
                                            </div>
                                            <div>
                                                <p className="text-xs text-slate-500 uppercase font-bold tracking-wider mb-1">憑證持有者 (Subject)</p>
                                                <p className="text-sm font-mono text-slate-700 truncate">{data.credentialSubject.id}</p>
                                            </div>
                                            <div>
                                                <p className="text-xs text-slate-500 uppercase font-bold tracking-wider mb-1">頒發日期</p>
                                                <p className="text-sm text-slate-700">{new Date(data.issuanceDate).toLocaleDateString()} {new Date(data.issuanceDate).toLocaleTimeString()}</p>
                                            </div>
                                        </div>
                                    </div>

                                    {/* 驗證區塊 */}
                                    <div className="border-t border-slate-100 pt-6">
                                        {verificationState === 'idle' ? (
                                            <button 
                                                onClick={runVerification}
                                                className="w-full py-3 bg-slate-900 hover:bg-slate-800 text-white rounded-xl font-bold flex items-center justify-center gap-2 transition shadow-lg shadow-slate-200"
                                            >
                                                <Lock className="w-4 h-4" /> 驗證數位簽章
                                            </button>
                                        ) : (
                                            <div className="space-y-3">
                                                {steps.map((step, idx) => (
                                                    <div key={idx} className="flex items-center gap-3 animate-fadeIn">
                                                        <div className="bg-green-100 p-1 rounded-full">
                                                            <CheckCircle className="w-4 h-4 text-green-600" />
                                                        </div>
                                                        <span className="text-sm text-slate-700 font-medium">{step.text}</span>
                                                    </div>
                                                ))}
                                                {verificationState === 'verifying' && (
                                                    <div className="flex items-center gap-3 animate-fadeIn">
                                                        <Loader className="w-6 h-6 text-slate-400" />
                                                        <span className="text-sm text-slate-400">正在與區塊鏈網路通訊...</span>
                                                    </div>
                                                )}
                                                {verificationState === 'verified' && (
                                                    <div className="mt-4 p-4 bg-green-50 rounded-xl border border-green-100 text-center animate-fadeIn">
                                                        <p className="text-green-800 font-bold text-lg mb-1">驗證成功</p>
                                                        <p className="text-green-600 text-sm">此產品護照資料真實且未被篡改。</p>
                                                    </div>
                                                )}
                                            </div>
                                        )}
                                    </div>
                                </div>
                            ) : (
                                // JSON 檢視模式
                                <div className="json-bg p-4 rounded-xl overflow-x-auto text-xs font-mono h-80 shadow-inner">
                                    <pre>{JSON.stringify(data, null, 2)}</pre>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // --- 組件: 首頁 ---
        const LandingPage = ({ onScan }) => (
            <div className="flex flex-col items-center justify-center min-h-screen bg-slate-50 p-6 text-center">
                <div className="bg-white p-8 rounded-2xl shadow-xl max-w-md w-full animate-fadeIn">
                    <div className="flex justify-center mb-6">
                        <div className="bg-green-100 p-4 rounded-full">
                            <QrCode className="w-12 h-12 text-green-600" />
                        </div>
                    </div>
                    <h1 className="text-2xl font-bold text-gray-800 mb-2">數位產品護照</h1>
                    <p className="text-gray-500 mb-4 text-sm">
                        請掃描產品上的 Digital Link QR Code 以查看產品履歷。
                    </p>

                    <div className="bg-slate-50 border border-slate-200 rounded p-3 mb-8 text-left">
                        <p className="text-[10px] text-gray-400 uppercase font-bold tracking-wider mb-1">Digital Link 網址格式</p>
                        <p className="text-xs font-mono text-gray-600 break-all select-all">
                        https://dpp-demo.sdpp.tw/#/01/<span className="text-green-600">{'{GTIN}'}</span>
                        </p>
                    </div>
                    
                    <div className="border-t border-gray-100 pt-6">
                        <p className="text-xs font-bold text-gray-400 uppercase tracking-wider mb-4">開發測試連結 (模擬掃描)</p>
                        <div className="space-y-3">
                            {Object.entries(PRODUCT_DATABASE).map(([gtin, prod]) => (
                                <button 
                                    key={gtin}
                                    onClick={() => onScan(gtin)}
                                    className="w-full py-3 px-4 bg-white border border-gray-200 rounded-lg hover:bg-green-50 hover:border-green-200 hover:text-green-700 transition flex items-center justify-between group"
                                >
                                    <div className="text-left">
                                        <span className="block font-medium text-sm text-gray-800 group-hover:text-green-800">{prod.name}</span>
                                        <span className="block text-xs text-gray-400 font-mono">GTIN: {gtin}</span>
                                    </div>
                                    <ArrowRight className="w-4 h-4 text-gray-300 group-hover:text-green-500" />
                                </button>
                            ))}
                        </div>
                    </div>
                </div>
                <div className="mt-8 text-xs text-gray-400 flex items-center justify-center gap-1">
                    Powered by <span className="font-semibold text-gray-500">dpp-demo.sdpp.tw</span>
                </div>
            </div>
        );

        // --- 組件: 產品詳情頁 ---
        const PassportPage = ({ product, gtin, onBack }) => {
            const [activeTab, setActiveTab] = useState('traceability');
            const [isCredentialOpen, setIsCredentialOpen] = useState(false);

            if (!product) return (
                <div className="flex flex-col items-center justify-center min-h-screen bg-gray-50 p-6">
                    <div className="bg-white p-8 rounded-xl shadow-lg text-center max-w-sm w-full animate-fadeIn">
                        <div className="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <X className="w-8 h-8 text-red-500" />
                        </div>
                        <h2 className="text-xl font-bold text-gray-800">查無此產品</h2>
                        <p className="text-gray-600 mt-2 text-sm">系統資料庫中找不到 GTIN 編號：<br/><span className="font-mono bg-gray-100 px-2 py-1 rounded mt-1 inline-block">{gtin}</span></p>
                        <button onClick={onBack} className="mt-6 w-full py-2.5 bg-gray-800 hover:bg-gray-700 text-white rounded-lg transition font-medium">返回首頁</button>
                    </div>
                </div>
            );

            return (
                <div className="min-h-screen bg-gray-50 pb-12 animate-fadeIn relative">
                    <CredentialModal 
                        isOpen={isCredentialOpen} 
                        onClose={() => setIsCredentialOpen(false)} 
                        data={product.verifiableCredential}
                    />

                    <div className="relative h-72 w-full bg-gray-900">
                        <img src={product.image} alt={product.name} className="w-full h-full object-cover opacity-90" />
                        <div className="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent" />
                        <button onClick={onBack} className="absolute top-4 left-4 bg-black/30 backdrop-blur-md text-white p-2 rounded-full hover:bg-black/50 transition border border-white/10">
                            <ArrowRight className="w-5 h-5 rotate-180" />
                        </button>
                        <div className="absolute bottom-0 left-0 right-0 p-6">
                            <div className="flex items-center gap-2 mb-2">
                                <span className="px-2 py-0.5 bg-green-500/90 text-white text-[10px] font-bold tracking-wider rounded uppercase backdrop-blur-sm flex items-center gap-1">
                                    <ShieldCheck className="w-3 h-3" /> Verifiable Credential
                                </span>
                            </div>
                            <h1 className="text-2xl font-bold text-white leading-tight mb-1">{product.name}</h1>
                            <p className="text-white/80 text-sm font-medium">{product.brand}</p>
                        </div>
                    </div>

                    <div className="px-4 -mt-4 relative z-10">
                        <div className="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden min-h-[50vh]">
                            <div className="flex border-b border-gray-100">
                                {['traceability', 'materials', 'info'].map(tab => (
                                    <button 
                                        key={tab}
                                        onClick={() => setActiveTab(tab)}
                                        className={`flex-1 py-4 text-sm font-medium flex items-center justify-center gap-1.5 transition-colors relative
                                        ${activeTab === tab ? 'text-green-700' : 'text-gray-400 hover:text-gray-600'}`}
                                    >
                                        {tab === 'traceability' && <Globe className="w-4 h-4" />}
                                        {tab === 'materials' && <Recycle className="w-4 h-4" />}
                                        {tab === 'info' && <Info className="w-4 h-4" />}
                                        <span className="capitalize">
                                            {tab === 'traceability' ? '旅程' : tab === 'materials' ? '材質' : '資訊'}
                                        </span>
                                        {activeTab === tab && <div className="absolute bottom-0 left-0 right-0 h-0.5 bg-green-600 rounded-t-full mx-4" />}
                                    </button>
                                ))}
                            </div>

                            <div className="p-6">
                                {activeTab === 'traceability' && (
                                    <div className="animate-fadeIn">
                                        <div className="flex items-center justify-between mb-6">
                                            <h3 className="font-bold text-gray-800 text-lg">產品足跡</h3>
                                            <span className="text-xs bg-green-50 text-green-700 px-2 py-1 rounded-full font-medium">全供應鏈追溯</span>
                                        </div>
                                        <div className="relative border-l-2 border-gray-100 pl-8 space-y-8 ml-2">
                                            {product.traceability.map((step, idx) => (
                                                <div key={idx} className="relative group">
                                                    <div className="absolute -left-[39px] bg-white p-1 rounded-full border border-gray-200 group-hover:border-green-500 transition-colors z-10">
                                                        <div className="bg-green-50 p-1.5 rounded-full">
                                                            <step.icon className="w-4 h-4 text-green-600" />
                                                        </div>
                                                    </div>
                                                    <div>
                                                        <span className="text-xs font-bold text-green-600 uppercase tracking-wide mb-1 block">{step.step}</span>
                                                        <p className="text-gray-900 font-bold text-base">{step.location}</p>
                                                        <p className="text-sm text-gray-400 mt-1 font-mono">{step.date}</p>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}
                                {activeTab === 'materials' && (
                                    <div className="space-y-8 animate-fadeIn">
                                        <div>
                                            <h3 className="font-bold text-gray-800 text-lg mb-4">材質組成</h3>
                                            <div className="space-y-5">
                                                {product.materials.map((mat, idx) => (
                                                    <div key={idx}>
                                                        <div className="flex justify-between text-sm mb-2">
                                                            <span className="font-medium text-gray-700">{mat.name}</span>
                                                            <span className="font-bold text-gray-900">{mat.percentage}%</span>
                                                        </div>
                                                        <div className="w-full bg-gray-100 rounded-full h-2.5 overflow-hidden">
                                                            <div className="bg-gradient-to-r from-green-500 to-emerald-400 h-full rounded-full transition-all duration-1000 ease-out" style={{ width: `${mat.percentage}%` }}></div>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                        <div className="bg-gradient-to-br from-blue-50 to-indigo-50 p-5 rounded-xl border border-blue-100">
                                            <h4 className="text-sm font-bold text-blue-900 mb-2 flex items-center gap-2">
                                                <Recycle className="w-4 h-4" /> 回收指示
                                            </h4>
                                            <p className="text-sm text-blue-800/80 leading-relaxed">{product.disposal}</p>
                                        </div>
                                    </div>
                                )}
                                {activeTab === 'info' && (
                                    <div className="space-y-6 animate-fadeIn">
                                        <h3 className="font-bold text-gray-800 text-lg">產品規格</h3>
                                        <div className="grid grid-cols-2 gap-3">
                                            <div className="p-4 bg-gray-50 rounded-xl border border-gray-100">
                                                <span className="text-xs text-gray-400 block mb-1">顏色</span>
                                                <span className="text-sm font-semibold text-gray-800">{product.specs.color}</span>
                                            </div>
                                            <div className="p-4 bg-gray-50 rounded-xl border border-gray-100">
                                                <span className="text-xs text-gray-400 block mb-1">尺寸</span>
                                                <span className="text-sm font-semibold text-gray-800">{product.specs.size}</span>
                                            </div>
                                            <div className="p-4 bg-gray-50 rounded-xl border border-gray-100 col-span-2 flex justify-between items-center">
                                                <div>
                                                    <span className="text-xs text-gray-400 block mb-1">生產批號</span>
                                                    <span className="text-sm font-semibold text-gray-800 font-mono">{product.specs.batch}</span>
                                                </div>
                                                <Package className="w-5 h-5 text-gray-300" />
                                            </div>
                                            <div className="p-4 bg-gray-50 rounded-xl border border-gray-100 col-span-2">
                                                <span className="text-xs text-gray-400 block mb-1">GTIN (全球識別碼)</span>
                                                <span className="text-sm font-semibold text-gray-800 font-mono tracking-wide">{gtin}</span>
                                            </div>
                                        </div>
                                        
                                        {/* 新增: 觸發 VC Modal 的按鈕區塊 */}
                                        <div className="pt-4 border-t border-gray-100">
                                            <button 
                                                onClick={() => setIsCredentialOpen(true)}
                                                className="w-full flex items-center justify-center gap-2 text-sm text-green-600 font-bold bg-green-50 py-3 rounded-lg hover:bg-green-100 transition"
                                            >
                                                <ShieldCheck className="w-4 h-4" />
                                                驗證區塊鏈證書 (Verifiable Credential)
                                            </button>
                                            <p className="text-xs text-center text-gray-400 mt-2">
                                                點擊上方按鈕以執行 W3C 標準 DID 驗證
                                            </p>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- 主程式 ---
        const App = () => {
            const [currentGtin, setCurrentGtin] = useState(null);

            const getGtinFromHash = () => {
                const hash = window.location.hash; 
                if (!hash) return null;
                const parts = hash.split('/');
                const identifierIndex = parts.indexOf('01');
                if (identifierIndex !== -1 && parts[identifierIndex + 1]) {
                    return parts[identifierIndex + 1];
                }
                return null;
            };

            useEffect(() => {
                setCurrentGtin(getGtinFromHash());
                const handleHashChange = () => setCurrentGtin(getGtinFromHash());
                window.addEventListener('hashchange', handleHashChange);
                return () => window.removeEventListener('hashchange', handleHashChange);
            }, []);

            const navigateToProduct = (gtin) => {
                window.location.hash = `/01/${gtin}`;
            };

            const navigateHome = () => {
                window.location.hash = '';
            };

            if (currentGtin) {
                const product = PRODUCT_DATABASE[currentGtin];
                return <PassportPage product={product} gtin={currentGtin} onBack={navigateHome} />;
            }
            return <LandingPage onScan={navigateToProduct} />;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
